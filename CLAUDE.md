# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Architecture

Nippogen is a full-stack application with a clear separation between frontend and backend:

### Backend (Spring Boot + Java 21)
- **Framework**: Spring Boot 3.5.4 with Java 21
- **Database**: PostgreSQL with JOOQ for type-safe database operations
- **Database Migration**: Flyway for database schema management
- **API Documentation**: SpringDoc OpenAPI with Swagger UI
- **Build Tool**: Gradle with wrapper
- **Location**: `/backend/` directory

### Frontend (React Native + Expo)
- **Framework**: Expo with React Native 0.79.5 and React 19.0.0
- **Styling**: TailwindCSS with NativeWind for React Native
- **Routing**: Expo Router with file-based routing
- **HTTP Client**: Axios for API communication
- **TypeScript**: Full TypeScript support with strict mode
- **Location**: `/frontend/` directory

### Type Safety & API Integration
- OpenAPI spec generated by SpringDoc from backend Java annotations
- TypeScript types auto-generated from OpenAPI spec via `openapi-typescript`
- Generated types located at `frontend/types/api.ts`

## Development Commands

### Project Setup
```bash
# Install all dependencies (frontend and backend)
make ready

# Frontend only setup
make front-ready

# Backend only setup  
make back-ready
```

### Development Workflow
```bash
# Start frontend development server (with tunnel for mobile testing)
cd frontend && npm run start

# Or use make command
make front

# Build and start backend with Docker
make back

# Backend build only
make build
```

### Database Operations
```bash
# Start PostgreSQL container
make up

# Access PostgreSQL shell
make psql

# Stop containers
make down

# Stop and remove database volumes
make down-v
```

### Code Quality & Types
```bash
# Frontend linting
cd frontend && npm run lint

# Generate TypeScript types from OpenAPI spec
cd frontend && npm run generate-types

# Backend tests
cd backend && ./gradlew test

# Backend build (includes tests)
cd backend && ./gradlew build
```

### Database & JOOQ
```bash
# Run database migrations
cd backend && ./gradlew flywayMigrate

# Generate JOOQ classes (automatically runs flyway migrate first)
cd backend && ./gradlew generateJooq
```

## Project Structure

### Backend Structure
- `src/main/java/com/example/backend/` - Main application code
- `src/main/resources/db/migration/` - Flyway migration files
- `src/main/resources/application.yml` - Spring configuration
- `build/generated-src/jooq/main/` - Generated JOOQ classes
- `openapi.json` - Generated OpenAPI specification

### Frontend Structure
- `app/` - Expo Router pages (file-based routing)
- `types/api.ts` - Generated TypeScript types from backend OpenAPI spec
- `global.css` - Global Tailwind CSS styles

## Database Configuration

### Development Database
- **Host**: localhost:5433 (to avoid conflicts with local PostgreSQL)
- **Database**: nippogen
- **User**: postgres
- **Password**: postgres

### Container Database (for backend connection)
- **Host**: db:5432
- **Database**: nippogen
- **User**: postgres
- **Password**: postgres

## API Documentation

- **Swagger UI**: http://localhost:8080/swagger-ui.html
- **OpenAPI JSON**: http://localhost:8080/api-docs

## Key Development Patterns

### Backend Development
- Use SpringDoc annotations (`@Operation`, `@Tag`) for API documentation
- Database changes must be made via Flyway migrations in `src/main/resources/db/migration/`
- After schema changes, regenerate JOOQ classes with `./gradlew generateJooq`
- Follow REST API conventions with `/api/` prefix

### Frontend Development
- Use Expo Router for navigation (file-based routing in `app/` directory)
- Style with TailwindCSS classes via NativeWind
- After backend API changes, regenerate types with `npm run generate-types`
- Import API types from `types/api.ts`

### Type Safety Workflow
1. Update backend controller with SpringDoc annotations
2. Restart backend to regenerate `openapi.json`
3. Run `npm run generate-types` in frontend
4. Use updated TypeScript types for type-safe API calls

## GitHub Workflow & Development Process

### Issue Management
- **Task Management**: Use GitHub Issues to track all development tasks and bugs
- **Issue Creation**: Create issues for all features, bugs, and improvements before starting work
- **Issue Templates**: **MUST** use GitHub issue template located in `.github/ISSUE_TEMPLATE/issue_template.md`
- **Linking**: Reference issue numbers in commits and PRs (e.g., `#123`, `fixes #456`)

### Commit Guidelines
- **Commit Granularity**: Make small, focused commits with single responsibility
- **Language**: Write commit messages in Japanese
- **Commit Messages**: Follow conventional commit format with Japanese descriptions:
  ```
  type(scope): 日本語での説明
  
  - feat: 新機能
  - fix: バグ修正
  - docs: ドキュメント変更
  - style: フォーマット変更
  - refactor: リファクタリング
  - test: テスト追加
  - chore: 保守作業
  ```
- **Examples**:
  ```
  feat(api): ユーザー認証エンドポイントを追加
  fix(frontend): ログインページのナビゲーション問題を修正
  docs(readme): インストール手順を更新
  refactor(backend): データベース接続処理をリファクタリング
  ```

### Pull Request Process
- **Language**: Write PR titles and descriptions in Japanese
- **PR Templates**: **MUST** use GitHub PR templates located in `.github/pull_request_template.md`
- **Branch Naming**: Use descriptive branch names (e.g., `feature/user-auth`, `fix/login-bug`)
- **Review Requirements**: 
  - All PRs must be reviewed by @Kazuuma-19
  - Do NOT self-merge PRs - wait for review approval
  - Address all review comments before requesting re-review
- **PR Creation**: Always include:
  - **変更内容**: Clear description of changes in Japanese
  - **関連Issue**: Reference to related issues
  - **実装の思考プロセス**: Explain the reasoning behind implementation decisions
    - なぜこのアプローチを選択したか
    - 他の選択肢と比較検討した内容
    - 実装時に考慮した点や制約
    - 将来の拡張性や保守性への配慮
  - **テスト手順**: Testing instructions
  - **スクリーンショット**: Screenshots/recordings for UI changes
  - **影響範囲**: Scope of changes and potential impacts

### Documentation Guidelines
- **Documentation Location**: Create all project documentation under `/docs` directory
- **Pre-Development Review**: Always review existing documentation in `/docs` before starting development
- **Documentation Types**:
  - Architecture decisions (ADR)
  - API specifications
  - Setup guides
  - Troubleshooting guides
  - Design documents

### Development Flow
1. **Issue Creation & Planning**:
   - Create GitHub Issue using **MANDATORY** template `.github/ISSUE_TEMPLATE/issue_template.md`
   - Break down the issue into specific subtasks using checkboxes:
     ```markdown
     ## タスク一覧
     - [ ] データベースマイグレーション作成
     - [ ] APIエンドポイント実装
     - [ ] フロントエンド画面作成
     - [ ] テストコード追加
     - [ ] ドキュメント更新
     ```
   - Assign appropriate labels and milestone

2. **Pre-Development**:
   - Review `/docs` directory for relevant documentation
   - Understand existing architecture and patterns
   - Create feature branch from main

3. **Implementation**:
   - Work through subtasks systematically
   - Check off completed subtasks with ✅ in the issue
   - Make granular commits in Japanese
   - Update documentation as needed

4. **Completion**:
   - Ensure all subtasks are checked off
   - Create PR using **MANDATORY** template `.github/pull_request_template.md`
   - Request review from @Kazuuma-19
   - Address feedback and wait for approval

### Code Review Process
1. Create feature branch from main
2. Review `/docs` directory before development
3. Implement changes with granular commits
4. Update issue with task completion checkmarks
5. Create PR using **MANDATORY** template `.github/pull_request_template.md`
6. Request review from @Kazuuma-19
7. Address review feedback
8. Wait for approval before merging
9. **NEVER** merge your own PRs

## Environment Requirements

- **Java**: 21 (configured in build.gradle)
- **Node.js**: Compatible with Expo SDK 53
- **Docker**: Required for PostgreSQL container
- **PostgreSQL**: 17 (via Docker container)