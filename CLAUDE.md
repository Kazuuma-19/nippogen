# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Architecture

Valet AI is a full-stack application with a clear separation between frontend and backend:

### Backend (Spring Boot + Java 21)
- **Framework**: Spring Boot 3.5.4 with Java 21
- **Database**: PostgreSQL with JOOQ for type-safe database operations
- **Database Migration**: Flyway for database schema management
- **API Documentation**: SpringDoc OpenAPI with Swagger UI
- **Build Tool**: Gradle with wrapper
- **Location**: `/backend/` directory

### Frontend (React Native + Expo)
- **Framework**: Expo with React Native 0.79.5 and React 19.0.0
- **Styling**: TailwindCSS with NativeWind for React Native
- **Routing**: Expo Router with file-based routing
- **HTTP Client**: Axios for API communication
- **TypeScript**: Full TypeScript support with strict mode
- **Location**: `/frontend/` directory

### Type Safety & API Integration
- OpenAPI spec generated by SpringDoc from backend Java annotations
- TypeScript types auto-generated from OpenAPI spec via `openapi-typescript`
- Generated types located at `frontend/types/api.ts`

## Development Commands

### Project Setup
```bash
# Install all dependencies (frontend and backend)
make ready

# Frontend only setup
make front-ready

# Backend only setup  
make back-ready
```

### Development Workflow
```bash
# Start frontend development server (with tunnel for mobile testing)
cd frontend && npm run start

# Or use make command
make front

# Build and start backend with Docker
make back

# Backend build only
make build
```

### Database Operations
```bash
# Start PostgreSQL container
make up

# Access PostgreSQL shell
make psql

# Stop containers
make down

# Stop and remove database volumes
make down-v
```

### Code Quality & Types
```bash
# Frontend linting
cd frontend && npm run lint

# Generate TypeScript types from OpenAPI spec
cd frontend && npm run generate-types

# Backend tests
cd backend && ./gradlew test

# Backend build (includes tests)
cd backend && ./gradlew build
```

### Database & JOOQ
```bash
# Run database migrations
cd backend && ./gradlew flywayMigrate

# Generate JOOQ classes (automatically runs flyway migrate first)
cd backend && ./gradlew generateJooq
```

## Project Structure

### Backend Structure
- `src/main/java/com/example/backend/` - Main application code
- `src/main/resources/db/migration/` - Flyway migration files
- `src/main/resources/application.yml` - Spring configuration
- `build/generated-src/jooq/main/` - Generated JOOQ classes
- `openapi.json` - Generated OpenAPI specification

### Frontend Structure
- `app/` - Expo Router pages (file-based routing)
- `types/api.ts` - Generated TypeScript types from backend OpenAPI spec
- `global.css` - Global Tailwind CSS styles

## Database Configuration

### Development Database
- **Host**: localhost:5433 (to avoid conflicts with local PostgreSQL)
- **Database**: valet_ai
- **User**: postgres
- **Password**: postgres

### Container Database (for backend connection)
- **Host**: db:5432
- **Database**: valet_ai
- **User**: postgres
- **Password**: postgres

## API Documentation

- **Swagger UI**: http://localhost:8080/swagger-ui.html
- **OpenAPI JSON**: http://localhost:8080/api-docs

## Key Development Patterns

### Backend Development
- Use SpringDoc annotations (`@Operation`, `@Tag`) for API documentation
- Database changes must be made via Flyway migrations in `src/main/resources/db/migration/`
- After schema changes, regenerate JOOQ classes with `./gradlew generateJooq`
- Follow REST API conventions with `/api/` prefix

### Frontend Development
- Use Expo Router for navigation (file-based routing in `app/` directory)
- Style with TailwindCSS classes via NativeWind
- After backend API changes, regenerate types with `npm run generate-types`
- Import API types from `types/api.ts`

### Type Safety Workflow
1. Update backend controller with SpringDoc annotations
2. Restart backend to regenerate `openapi.json`
3. Run `npm run generate-types` in frontend
4. Use updated TypeScript types for type-safe API calls

## Environment Requirements

- **Java**: 21 (configured in build.gradle)
- **Node.js**: Compatible with Expo SDK 53
- **Docker**: Required for PostgreSQL container
- **PostgreSQL**: 17 (via Docker container)